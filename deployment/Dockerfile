FROM python:3.11-slim

COPY . /app

WORKDIR /app

ARG DOWLOAD_MODEL_FLAG
ENV DOWLOAD_MODEL_FLAG $DOWLOAD_MODEL_FLAG

ARG MLFLOW_TRACKING_URI
ENV MLFLOW_TRACKING_URI $MLFLOW_TRACKING_URI

ARG MLFLOW_MODEL_VERSION
ENV MLFLOW_MODEL_VERSION $MLFLOW_MODEL_VERSION

ARG MODEL_DIR
ENV MODEL_DIR $MODEL_DIR

RUN pip install pipenv
RUN pipenv install --system --deploy

RUN python -m deployment.download_model

EXPOSE 8080

CMD python -m deployment.main
